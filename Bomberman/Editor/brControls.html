<html>
<head>
<title>brControls.html</title>
</head>
<!-- Generated by SynEdit HTML exporter -->
<body text="#000000" bgcolor="#FFFFFF">
<pre>
<code><font  size=3 face="Courier New"><font color="#000080"><i>(*******************************************************)
(*                                                     *)
(*       Engine Paulovich DirectX                      *)
(*       Win32-DirectX API Unit                        *)
(*                                                     *)
(*       Copyright (c) 2003-2004, Ivan Paulovich       *)
(*                                                     *)
(*       iskatrek@hotmail.com  uin#89160524            *)
(*                                                     *)
(*       Unit: brControls                              *)
(*                                                     *)
(*******************************************************)

</i></font><b>unit </b>brControls;

<b>interface

uses
  </b>Windows, Messages, SysUtils, Classes, brUtils;

<b>type

  </b><font color="#000080"><i>(* Eventos *)

  </i></font>TMouseButton = (mbLeft, mbRight, mbMiddle);
  TShiftState = <b>set of </b>(ssShift, ssAlt, ssCtrl,
    ssLeft, ssRight, ssMiddle, ssDouble);
  TNotifyEvent = <b>procedure</b>(Sender: TObject) <b>of object</b>;
  TCommandEvent = <b>procedure</b>(Sender: TObject; ID: Integer) <b>of object</b>;
  TMouseEvent = <b>procedure</b>(Sender: TObject; Button: TMouseButton;
    Shift: TShiftState; X, Y: Integer) <b>of object</b>;
  TMouseMoveEvent = <b>procedure</b>(Sender: TObject; Shift: TShiftState;
    X, Y: Integer) <b>of object</b>;
  TKeyEvent = <b>procedure</b>(Sender: TObject; <b>var </b>Key: Word;
    Shift: TShiftState) <b>of object</b>;
  TKeyPressEvent = <b>procedure</b>(Sender: TObject; <b>var </b>Key: Char) <b>of object</b>;

  PControl = ^TControl;
  TControl = <b>class
  private
    </b>FOnCreate: TNotifyEvent;
    FOnInitialize: TNotifyEvent;
    FOnFinalize: TNotifyEvent;
    FOnResize: TNotifyEvent;
    FOnClick: TNotifyEvent;
    FOnDblClick: TNotifyEvent;
    FOnMouseDown: TMouseEvent;
    FOnMouseMove: TMouseMoveEvent;
    FOnMouseUp: TMouseEvent;
    FOnKeyDown: TKeyEvent;
    FOnKeyPress: TKeyPressEvent;
    FOnKeyUp: TKeyEvent;
    FOnMouseEnter: TNotifyEvent;
    FOnMouseLeave: TNotifyEvent;
  <b>protected
    procedure </b>SetWidth(Value: Integer); <b>virtual</b>;
    <b>procedure </b>SetHeight(Value: Integer); <b>virtual</b>;
    <b>procedure </b>SetLeft(Value: Integer); <b>virtual</b>;
    <b>procedure </b>SetTop(Value: Integer); <b>virtual</b>;
  <b>public
    </b>Clicked: Boolean;
    ClientRect: TRect;
    MouseIn: Boolean;
    <b>constructor </b>Create; <b>virtual</b>;
    <b>procedure </b>MouseDown(<b>var Message</b>: TWMMouse; Button: TMouseButton;
      Shift: TShiftState);
    <b>procedure </b>MouseMove(<b>var Message</b>: TWMMouse);
    <b>procedure </b>MouseUp(<b>var Message</b>: TWMMouse; Button: TMouseButton);
    <b>function </b>KeyDown(<b>var Message</b>: TWMKey): Boolean;
    <b>function </b>KeyPress(<b>var Message</b>: TWMKey): Boolean;
    <b>function </b>KeyUp(<b>var Message</b>: TWMKey): Boolean;
    <b>procedure </b>DoCreate; <b>virtual</b>;
    <b>procedure </b>DoInitialize; <b>virtual</b>;
    <b>procedure </b>DoFinalize; <b>virtual</b>;
    <b>procedure </b>DoResize; <b>virtual</b>;
    <b>procedure </b>DoClick; <b>virtual</b>;
    <b>procedure </b>DoDblClick; <b>virtual</b>;
    <b>procedure </b>DoMouseDown(Button: TMouseButton; Shift: TShiftState;
      X, Y: Integer); <b>virtual</b>;
    <b>procedure </b>DoMouseMove(Shift: TShiftState; X, Y: Integer); <b>virtual</b>;
    <b>procedure </b>DoMouseUp(Button: TMouseButton; Shift: TShiftState;
      X, Y: Integer); <b>virtual</b>;
    <b>procedure </b>DoKeyDown(<b>var </b>Key: Word; Shift: TShiftState); <b>virtual</b>;
    <b>procedure </b>DoKeyPress(<b>var </b>Key: Char); <b>virtual</b>;
    <b>procedure </b>DoKeyUp(<b>var </b>Key: Word; Shift: TShiftState); <b>virtual</b>;
    <b>procedure </b>DoMouseEnter; <b>virtual</b>;
    <b>procedure </b>DoMouseLeave; <b>virtual</b>;
    <b>property </b>Left: Integer <b>read </b>ClientRect.Left <b>write </b>SetLeft;
    <b>property </b>Top: Integer <b>read </b>ClientRect.Top <b>write </b>SetTop;
    <b>property </b>Width: Integer <b>read </b>ClientRect.Right <b>write </b>SetWidth;
    <b>property </b>Height: Integer <b>read </b>ClientRect.Bottom <b>write </b>SetHeight;
    <b>property </b>OnCreate: TNotifyEvent <b>read </b>FOnCreate <b>write </b>FOnCreate;
    <b>property </b>OnInitialize: TNotifyEvent <b>read </b>FOnInitialize <b>write </b>FOnInitialize;
    <b>property </b>OnFinalize: TNotifyEvent <b>read </b>FOnFinalize <b>write </b>FOnFinalize;
    <b>property </b>OnClick: TNotifyEvent <b>read </b>FOnClick <b>write </b>FOnClick;
    <b>property </b>OnDblClick: TNotifyEvent <b>read </b>FOnDblClick <b>write </b>FOnDblClick;
    <b>property </b>OnMouseDown: TMouseEvent <b>read </b>FOnMouseDown <b>write </b>FOnMouseDown;
    <b>property </b>OnMouseMove: TMouseMoveEvent <b>read </b>FOnMouseMove <b>write </b>FOnMouseMove;
    <b>property </b>OnMouseUp: TMouseEvent <b>read </b>FOnMouseUp <b>write </b>FOnMouseUp;
    <b>property </b>OnKeyDown: TKeyEvent <b>read </b>FOnKeyDown <b>write </b>FOnKeyDown;
    <b>property </b>OnKeyPress: TKeyPressEvent <b>read </b>FOnKeyPress <b>write </b>FOnKeyPress;
    <b>property </b>OnKeyUp: TKeyEvent <b>read </b>FOnKeyUp <b>write </b>FOnKeyUp;
    <b>property </b>OnMouseEnter: TNotifyEvent <b>read </b>FOnMouseEnter <b>write </b>FOnMouseEnter;
    <b>property </b>OnMouseLeave: TNotifyEvent <b>read </b>FOnMouseLeave <b>write </b>FOnMouseLeave;
  <b>end</b>;

<b>function </b>KeysToShiftState(Keys: Word): TShiftState;
<b>function </b>KeyDataToShiftState(KeyData: Longint): TShiftState;

<b>var
  </b>ControlList: TList;

<b>implementation

function </b>KeysToShiftState(Keys: Word): TShiftState;
<b>begin
  </b>Result := [];
  <b>if </b>Keys <b>and </b>MK_SHIFT &lt;&gt; <font color="#000080">0 </font><b>then </b>Include(Result, ssShift);
  <b>if </b>Keys <b>and </b>MK_CONTROL &lt;&gt; <font color="#000080">0 </font><b>then </b>Include(Result, ssCtrl);
  <b>if </b>Keys <b>and </b>MK_LBUTTON &lt;&gt; <font color="#000080">0 </font><b>then </b>Include(Result, ssLeft);
  <b>if </b>Keys <b>and </b>MK_RBUTTON &lt;&gt; <font color="#000080">0 </font><b>then </b>Include(Result, ssRight);
  <b>if </b>Keys <b>and </b>MK_MBUTTON &lt;&gt; <font color="#000080">0 </font><b>then </b>Include(Result, ssMiddle);
  <b>if </b>GetKeyState(VK_MENU) &lt; <font color="#000080">0 </font><b>then </b>Include(Result, ssAlt);
<b>end</b>;

<b>function </b>KeyDataToShiftState(KeyData: Longint): TShiftState;
<b>const
  </b>AltMask = <font color="#000080">$20000000</font>;
<b>begin
  </b>Result := [];
  <b>if </b>GetKeyState(VK_SHIFT) &lt; <font color="#000080">0 </font><b>then </b>Include(Result, ssShift);
  <b>if </b>GetKeyState(VK_CONTROL) &lt; <font color="#000080">0 </font><b>then </b>Include(Result, ssCtrl);
  <b>if </b>KeyData <b>and </b>AltMask &lt;&gt; <font color="#000080">0 </font><b>then </b>Include(Result, ssAlt);
<b>end</b>;

<b>constructor </b>TControl.Create;
<b>begin
  </b>ControlList.Add(Self);
<b>end</b>;

<b>procedure </b>TControl.MouseDown(<b>var Message</b>: TWMMouse; Button: TMouseButton;
  Shift: TShiftState);
<b>begin
  with Message do
    if </b>PointInRect(Point(XPos, YPos), Bounds(Left, Top, Width, Height)) <b>then
    begin
      </b>Clicked := True;
      DoMouseDown(Button, KeysToShiftState(Keys) + Shift, XPos, YPos);
      DoClick;
    <b>end</b>;
<b>end</b>;

<b>procedure </b>TControl.MouseMove(<b>var Message</b>: TWMMouse);
<b>begin
  with Message do
    if </b>PointInRect(Point(XPos, YPos), Bounds(Left, Top, Width, Height)) <b>then
    begin
      </b>DoMouseMove(KeysToShiftState(Keys), XPos, YPos);
      <b>if not </b>MouseIn <b>then
        </b>DoMouseEnter;
      MouseIn := True;
    <b>end
    else
    begin
      if </b>MouseIn <b>then
        </b>DoMouseLeave;
      MouseIn := False;
    <b>end</b>;
<b>end</b>;

<b>procedure </b>TControl.MouseUp(<b>var Message</b>: TWMMouse; Button: TMouseButton);
<b>begin
  with Message do
    if </b>PointInRect(Point(XPos, YPos), Bounds(Left, Top, Width, Height)) <b>then
      </b>DoMouseUp(Button, KeysToShiftState(Keys), XPos, YPos);
  Clicked := False;
<b>end</b>;

<b>function </b>TControl.KeyDown(<b>var Message</b>: TWMKey): Boolean;
<b>var
  </b>ShiftState: TShiftState;
<b>begin
  with Message do
  begin
    </b>ShiftState := KeyDataToShiftState(KeyData);
    DoKeyDown(CharCode, ShiftState);
  <b>end</b>;
  Result := <b>Message</b>.CharCode &lt;&gt; <font color="#000080">0</font>;
<b>end</b>;

<b>function </b>TControl.KeyPress(<b>var Message</b>: TWMKey): Boolean;
<b>var
  </b>Ch: Char;
<b>begin
  with Message do
  begin
    </b>Ch := Char(CharCode);
    DoKeyPress(Ch);
    CharCode := Word(Ch);
  <b>end</b>;
  Result := Char(<b>Message</b>.CharCode) &lt;&gt; <font color="#000080">#0</font>;
<b>end</b>;

<b>function </b>TControl.KeyUp(<b>var Message</b>: TWMKey): Boolean;
<b>var
  </b>ShiftState: TShiftState;
<b>begin
  with Message do
  begin
    </b>ShiftState := KeyDataToShiftState(KeyData);
    DoKeyUp(CharCode, ShiftState);
  <b>end</b>;
  Result := <b>Message</b>.CharCode &lt;&gt; <font color="#000080">0</font>;
<b>end</b>;

<b>procedure </b>TControl.DoCreate;
<b>begin
  if </b>Assigned(FOnCreate) <b>then </b>FOnCreate(Self);
<b>end</b>;

<b>procedure </b>TControl.DoInitialize;
<b>begin
  if </b>Assigned(FOnInitialize) <b>then </b>FOnInitialize(Self);
<b>end</b>;

<b>procedure </b>TControl.DoFinalize;
<b>begin
  if </b>Assigned(FOnFinalize) <b>then </b>FOnFinalize(Self);
<b>end</b>;

<b>procedure </b>TControl.DoResize;
<b>begin
  if </b>Assigned(FOnResize) <b>then </b>FOnResize(Self);
<b>end</b>;

<b>procedure </b>TControl.DoClick;
<b>begin
  if </b>Assigned(FOnClick) <b>then </b>FOnClick(Self);
<b>end</b>;

<b>procedure </b>TControl.DoDblClick;
<b>begin
  if </b>Assigned(FOnDblClick) <b>then </b>FOnDblClick(Self);
<b>end</b>;

<b>procedure </b>TControl.DoMouseDown(Button: TMouseButton; Shift: TShiftState; X,
  Y: Integer);
<b>begin
  if </b>Assigned(FOnMouseDown) <b>then </b>FOnMouseDown(Self, Button, Shift, Left, Top);
<b>end</b>;

<b>procedure </b>TControl.DoMouseMove(Shift: TShiftState; X, Y: Integer);
<b>begin
  if </b>Assigned(FOnMouseMove) <b>then </b>FOnMouseMove(Self, Shift, Left, Top);
<b>end</b>;

<b>procedure </b>TControl.DoMouseUp(Button: TMouseButton; Shift: TShiftState; X,
  Y: Integer);
<b>begin
  if </b>Assigned(FOnMouseUp) <b>then </b>FOnMouseUp(Self, Button, Shift, Left, Top);
<b>end</b>;

<b>procedure </b>TControl.DoKeyDown(<b>var </b>Key: Word; Shift: TShiftState);
<b>begin
  if </b>Assigned(FOnKeyDown) <b>then </b>FOnKeyDown(Self, Key, Shift);
<b>end</b>;

<b>procedure </b>TControl.DoKeyPress(<b>var </b>Key: Char);
<b>begin
  if </b>Assigned(FOnKeyPress) <b>then </b>FOnKeyPress(Self, Key);
<b>end</b>;

<b>procedure </b>TControl.DoKeyUp(<b>var </b>Key: Word; Shift: TShiftState);
<b>begin
  if </b>Assigned(FOnKeyUp) <b>then </b>FOnKeyUp(Self, Key, Shift);
<b>end</b>;

<b>procedure </b>TControl.DoMouseEnter;
<b>begin
  if </b>Assigned(FOnMouseEnter) <b>then </b>FOnMouseEnter(Self);
<b>end</b>;

<b>procedure </b>TControl.DoMouseLeave;
<b>begin
  if </b>Assigned(FOnMouseLeave) <b>then </b>FOnMouseLeave(Self);
<b>end</b>;

<b>procedure </b>TControl.SetWidth(Value: Integer);
<b>begin
  </b>ClientRect.Right := Value;
<b>end</b>;

<b>procedure </b>TControl.SetHeight(Value: Integer);
<b>begin
  </b>ClientRect.Bottom := Value;
<b>end</b>;

<b>procedure </b>TControl.SetLeft(Value: Integer);
<b>begin
  </b>ClientRect.Left := Value;
<b>end</b>;

<b>procedure </b>TControl.SetTop(Value: Integer);
<b>begin
  </b>ClientRect.Top := Value;
<b>end</b>;

<b>initialization
  </b>ControlList := TList.Create;

<b>end</b>.

</font>
</code></pre>
</body>
</html>